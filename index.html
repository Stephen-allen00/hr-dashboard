<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HR Solutions Team - Call Analytics Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        /* --- Base styles (unchanged) --- */
        * {margin:0;padding:0;box-sizing:border-box;}
        body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:#182B49;min-height:100vh;color:#333;transition:background .3s,color .3s;}
        body.light-theme{background:#f3f4f6;color:#222;}
        /* Light‚Äëtheme overrides for key cards/containers */
        body.light-theme .header,
        body.light-theme .stat-card,
        body.light-theme .chart-container,
        body.light-theme .data-table,
        body.light-theme .admin-panel,
        body.light-theme .settings-panel{background:rgba(255,255,255,.95);}
        
        /* --- existing styles kept intact (truncated for brevity) --- */
        /* copy of all original CSS here, unchanged ... */
        /* (for brevity in this snippet, retain original CSS from the user's file) */

        /* Add subtle toggle style */
        .toggle-switch{position:relative;display:inline-block;width:50px;height:24px;}
        .toggle-switch input{opacity:0;width:0;height:0;}
        .slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background:#ccc;transition:.4s;border-radius:34px;}
        .slider:before{position:absolute;content:"";height:18px;width:18px;left:3px;bottom:3px;background:white;transition:.4s;border-radius:50%;}
        input:checked + .slider{background:#28a745;}
        input:checked + .slider:before{transform:translateX(26px);}        
    </style>
</head>
<body>
<div class="dashboard">
    <!-- Settings & Admin Toggle Buttons -->
    <button class="settings-toggle" onclick="toggleSettings()">‚öôÔ∏è</button>
    <button class="admin-toggle" onclick="toggleAdmin()">üë•</button>

    <!-- Header (unchanged) -->
    <div class="header">
        <h1>The <span class="hr-text">HR</span> Solutions Team</h1>
        <p>Powered by AI - Call Analytics Dashboard</p>
    </div>

    <!-- Controls (unchanged) -->
    <div class="controls">
        <!-- same HTML as original for baserowUrl/apiToken/dateRange/refreshRate & load buttons -->
        <!-- ... omitted for brevity -->
    </div>

    <!-- Status bar, dashboard content, admin panel etc. (all original markup) -->
    <!-- ... omitted for brevity ... -->

    <!-- Settings Panel (UPDATED) -->
    <div id="settingsPanel" class="settings-panel">
        <div class="settings-header">
            <div class="settings-title">Settings</div>
            <button class="close-settings" onclick="toggleSettings()">&times;</button>
        </div>
        <div class="admin-section">
            <h3>Dashboard Settings</h3>
            <form id="settingsForm" onsubmit="saveSettings(event)" class="user-form">
                <div class="form-group">
                    <label for="settingsTheme">Theme</label>
                    <select id="settingsTheme">
                        <option value="dark">Dark</option>
                        <option value="light">Light</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="settingsDefaultDateRange">Default Date Range</label>
                    <select id="settingsDefaultDateRange">
                        <option value="7">Last 7 days</option>
                        <option value="30">Last 30 days</option>
                        <option value="90">Last 90 days</option>
                        <option value="365">Last year</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="settingsRefreshInterval">Auto‚Äërefresh Interval (minutes)</label>
                    <select id="settingsRefreshInterval">
                        <option value="5">5</option>
                        <option value="15">15</option>
                        <option value="30">30</option>
                        <option value="60">60</option>
                    </select>
                </div>
                <div class="form-group" style="flex-direction:row;align-items:center;gap:10px;">
                    <input type="checkbox" id="settingsAutoRefresh" />
                    <label for="settingsAutoRefresh">Enable Auto‚Äërefresh on load</label>
                </div>
                <button type="submit" class="btn-save">Save Settings</button>
            </form>
        </div>
    </div>
</div>

<script>
    /* ------------------------- Settings logic ------------------------- */
    const defaultSettings = {
        theme: 'dark',
        defaultDateRange: 30,
        autoRefresh: false,
        refreshInterval: 60
    };
    let settings;
    try {
        settings = {...defaultSettings, ...JSON.parse(localStorage.getItem('hr_dashboard_settings')||'{}')};
    } catch(e){settings = {...defaultSettings};}

    function applySettings(){
        // theme
        if(settings.theme==='light'){
            document.body.classList.add('light-theme');
        }else{
            document.body.classList.remove('light-theme');
        }
        // set control defaults
        const dateSel=document.getElementById('dateRange');
        const refreshSel=document.getElementById('refreshRate');
        if(dateSel) dateSel.value = settings.defaultDateRange;
        if(refreshSel) refreshSel.value = settings.refreshInterval;
    }

    function loadSettingsPanel(){
        document.getElementById('settingsTheme').value = settings.theme;
        document.getElementById('settingsDefaultDateRange').value = settings.defaultDateRange;
        document.getElementById('settingsRefreshInterval').value = settings.refreshInterval;
        document.getElementById('settingsAutoRefresh').checked = settings.autoRefresh;
    }

    function saveSettings(e){
        e.preventDefault();
        settings.theme = document.getElementById('settingsTheme').value;
        settings.defaultDateRange = parseInt(document.getElementById('settingsDefaultDateRange').value);
        settings.refreshInterval = parseInt(document.getElementById('settingsRefreshInterval').value);
        settings.autoRefresh = document.getElementById('settingsAutoRefresh').checked;
        localStorage.setItem('hr_dashboard_settings', JSON.stringify(settings));
        applySettings();
        toggleSettings();
        alert('Settings saved & applied!');
    }

    /* ------------------ Existing dashboard JS (original) ------------------ */
    // Place the entire original JS code here (unchanged) but ensure:
    // 1. window.onload now calls initDashboard() instead of loadData() directly
    // 2. startAutoRefresh() uses settings.refreshInterval when invoked from settings

    let charts={},callData=[],autoRefreshInterval,lastRefreshTime=new Date();
    /* ... (rest of original admin/user/database functions unchanged) ... */

    function initDashboard(){
        applySettings();
        loadData();
        if(settings.autoRefresh){
            startAutoRefresh();
        }
    }

    // Overwrite toggleSettings to load panel data
    function toggleSettings(){
        const panel=document.getElementById('settingsPanel');
        panel.classList.toggle('open');
        if(panel.classList.contains('open')){
            loadSettingsPanel();
        }
    }

    // Modify startAutoRefresh to respect new interval param
    function startAutoRefresh(){
        const selected=document.getElementById('refreshRate').value;
        const intervalMs=selected*60000;
        settings.refreshInterval=parseInt(selected);
        localStorage.setItem('hr_dashboard_settings',JSON.stringify(settings));
        if(autoRefreshInterval) clearInterval(autoRefreshInterval);
        autoRefreshInterval=setInterval(()=>{loadData();lastRefreshTime=new Date();updateLastRefreshDisplay();},intervalMs);
        updateLastRefreshDisplay();
    }

    window.addEventListener('DOMContentLoaded',initDashboard);
</script>
</body>
</html>
